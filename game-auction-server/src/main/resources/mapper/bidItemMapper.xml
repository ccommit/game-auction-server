<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ccommit.gameauctionserver.mapper.BidItemMapper">

    <select id="getUserInfoFromId" resultType="com.ccommit.gameauctionserver.dto.User">
        SELECT   id
                ,user_id as userId
                ,nickname
                ,phone_number as phoneNumber
                ,gold
                ,user_level as userLevel
                ,user_type as userType
        FROM    user
        WHERE   user_id = #{user_Id}
    </select>

    <select id="getBidInfoFromId" resultType="com.ccommit.gameauctionserver.dto.Bid">
        SELECT   id
                ,create_time as createTime
                ,limit_time as limitTime
                ,price as price
                ,start_price as startPrice
                ,present_price as presentPrice
                ,highestbidder_id as highestBidderId
                ,seller_id as sellerId
                ,issold as isSold
                ,item_id as itemId
        FROM    bid
        WHERE   id = #{id}
    </select>

    <!-- TODO : Join을 통한 연산처리 구현 예정-->
    <update id="updateItemByUserId">
        UPDATE  item
        SET     user_id = #{userId}
        WHERE   id = #{itemId}
    </update>

    <update id="updateBuyerUserGold">
        UPDATE  user
        SET     gold = gold - #{priceGold}
        WHERE   id = #{userId}
    </update>

    <update id="updateSellerUserGold">
        UPDATE  user
        SET     gold = gold + #{priceGold}
        WHERE   user_id = #{sellerId}
    </update>

    <delete id="deleteItemToBid">
        DELETE FROM bid
        WHERE id = #{bidId}
    </delete>

</mapper>